"use strict";(self.webpackChunkultimate_jekyll=self.webpackChunkultimate_jekyll||[]).push([[2984],{2984:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(9754),r=s(6110);class a{constructor(t,e={}){if(this.$form="string"==typeof t?document.querySelector(t):t,!this.$form)throw new Error(`FormManager: Form not found: ${t}`);this.config={autoReady:!0,initialState:"ready",allowResubmit:!0,resetOnSuccess:!1,warnOnUnsavedChanges:!1,submittingText:"Processing...",submittedText:"Processed!",...e},this.state="initializing",this._isDirty=!1,this._listeners={change:[],validation:[],submit:[],statechange:[]},this._fieldErrors={},this._beforeUnloadHandler=t=>this._handleBeforeUnload(t),this._init()}_init(){this._setDisabled(!0),this.$form.addEventListener("submit",t=>this._handleSubmit(t)),this.$form.addEventListener("input",t=>this._handleChange(t)),this.$form.addEventListener("change",t=>this._handleChange(t)),this.config.warnOnUnsavedChanges&&window.addEventListener("beforeunload",this._beforeUnloadHandler),window.addEventListener("pageshow",t=>this._handlePageShow(t)),this.config.autoReady&&(0,i.ready)().then(()=>this._setInitialState())}on(t,e){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),this}async _emit(t,e){const s=this._listeners[t]||[];for(const t of s)await t(e)}_setInitialState(){const t=this.config.initialState;"ready"===t?this.ready():this._setState(t)}ready(){this._setState("ready"),this._setDisabled(!1);const t=this.$form.querySelector("[autofocus]");t&&!t.disabled&&t.focus()}async _handleSubmit(t){if(t.preventDefault(),"ready"!==this.state)return;const e=t.submitter,s=this.getData();if(this.clearFieldErrors(),await this._runValidation(s,e)){this._setState("submitting"),this._setDisabled(!0),this._showSpinner(!0);try{await this._emit("submit",{data:s,$submitButton:e}),this.setDirty(!1),this._showSpinner(!1),this.config.resetOnSuccess&&this.$form.reset(),this.config.allowResubmit?(this._setState("ready"),this._setDisabled(!1)):(this._setState("submitted"),this._showSubmittedText())}catch(t){this._setState("ready"),this._setDisabled(!1),this._showSpinner(!1),this.showError(t.message||"An error occurred")}}}_handleChange(t){this.setDirty(!0);const e=this.getData();this._emit("change",{field:t.target,name:t.target.name,value:t.target.value,data:e}),this._fieldErrors[t.target.name]&&this._clearFieldError(t.target.name)}async _runValidation(t,e){const s=(t,e)=>{this._fieldErrors[t]=e};return this._runHTML5Validation(s),await this._emit("validation",{data:t,setError:s,$submitButton:e}),!(Object.keys(this._fieldErrors).length>0&&(this._displayFieldErrors(),this._focusFirstError(),1))}_runHTML5Validation(t){this.$form.querySelectorAll("input, select, textarea").forEach(e=>{const s=e.name;if(!s)return;if(this._fieldErrors[s])return;const i=e.value,r=e.type;if(e.hasAttribute("required")){if("checkbox"===r&&!e.checked)return void t(s,"This field is required");if(!i||!i.trim())return void t(s,"This field is required")}if(i){if("email"===r&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i))return void t(s,"Please enter a valid email address");if("url"===r)try{new URL(i)}catch{return void t(s,"Please enter a valid URL")}if(e.hasAttribute("minlength")){const r=parseInt(e.getAttribute("minlength"),10);if(i.length<r)return void t(s,`Must be at least ${r} characters`)}if(e.hasAttribute("maxlength")){const r=parseInt(e.getAttribute("maxlength"),10);if(i.length>r)return void t(s,`Must be no more than ${r} characters`)}if(e.hasAttribute("min")){const a=e.getAttribute("min");if("number"===r||"range"===r){if(parseFloat(i)<parseFloat(a))return void t(s,`Must be at least ${a}`)}else if(("date"===r||"datetime-local"===r)&&new Date(i)<new Date(a))return void t(s,`Must be on or after ${a}`)}if(e.hasAttribute("max")){const a=e.getAttribute("max");if("number"===r||"range"===r){if(parseFloat(i)>parseFloat(a))return void t(s,`Must be no more than ${a}`)}else if(("date"===r||"datetime-local"===r)&&new Date(i)>new Date(a))return void t(s,`Must be on or before ${a}`)}if(e.hasAttribute("pattern")&&!new RegExp(`^${e.getAttribute("pattern")}$`).test(i)){const i=e.getAttribute("title")||"Please match the requested format";return void t(s,i)}}})}_displayFieldErrors(){for(const[t,e]of Object.entries(this._fieldErrors))this._showFieldError(t,e)}_showFieldError(t,e){const s=this.$form.querySelector(`[name="${t}"]`);if(!s)return;s.classList.add("is-invalid");let i=s.parentElement.querySelector(".invalid-feedback");i||(i=document.createElement("div"),i.className="invalid-feedback","checkbox"===s.type||"radio"===s.type?(s.closest(".form-check")||s.parentElement).appendChild(i):s.parentElement.appendChild(i)),i.textContent=e,i.style.display="block"}_clearFieldError(t){delete this._fieldErrors[t];const e=this.$form.querySelector(`[name="${t}"]`);if(!e)return;e.classList.remove("is-invalid");const s=e.parentElement.querySelector(".invalid-feedback");s&&(s.style.display="none")}clearFieldErrors(){for(const t of Object.keys(this._fieldErrors))this._clearFieldError(t);this._fieldErrors={}}_focusFirstError(){const t=Object.keys(this._fieldErrors)[0];if(!t)return;const e=this.$form.querySelector(`[name="${t}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus())}throwFieldErrors(t){for(const[e,s]of Object.entries(t))this._fieldErrors[e]=s;throw this._displayFieldErrors(),this._focusFirstError(),new Error("Validation failed")}_handleBeforeUnload(t){this._isDirty&&(t.preventDefault(),t.returnValue="")}_handlePageShow(t){t.persisted&&"submitting"===this.state&&(this._showSpinner(!1),this.ready())}setDirty(t){this._isDirty!==t&&(this._isDirty=t)}_setState(t){const e=this.state;this.state=t,this.$form.setAttribute("data-form-state",t),this._emit("statechange",{state:t,previousState:e})}_setDisabled(t){this.$form.querySelectorAll("button, input, select, textarea").forEach(e=>{e.disabled=t})}_getSubmitButtons(){return Array.from(this.$form.querySelectorAll("button")).filter(t=>"submit"===t.type)}_showSpinner(t){this._getSubmitButtons().forEach(e=>{t?(e._originalHTML=e.innerHTML,e.innerHTML=`<span class="spinner-border spinner-border-sm me-2"></span>${this.config.submittingText}`):e._originalHTML&&(e.innerHTML=e._originalHTML)})}_showSubmittedText(){this._getSubmitButtons().forEach(t=>{const e=t.querySelector(".button-text");e?e.textContent=this.config.submittedText:t.textContent=this.config.submittedText})}_setNested(t,e,s){const i=e.split("."),r=i.pop();let a=t;for(const t of i)a[t]&&"object"==typeof a[t]||(a[t]={}),a=a[t];void 0!==a[r]?(Array.isArray(a[r])||(a[r]=[a[r]]),a[r].push(s)):a[r]=s}_getNested(t,e){return e.split(".").reduce((t,e)=>t&&void 0!==t[e]?t[e]:void 0,t)}getData(){const t=new FormData(this.$form),e={},s={};this.$form.querySelectorAll('input[type="checkbox"]').forEach(t=>{s[t.name]=(s[t.name]||0)+1});for(const[i,r]of t.entries())s[i]||this._setNested(e,i,r);const i=new Set;return this.$form.querySelectorAll('input[type="checkbox"]').forEach(t=>{const r=t.name;if(1===s[r])return void this._setNested(e,r,t.checked);if(i.has(r))return;i.add(r);const a={};this.$form.querySelectorAll(`input[type="checkbox"][name="${r}"]`).forEach(t=>{a[t.value]=t.checked}),this._setNested(e,r,a)}),e}showSuccess(t){(0,r.showNotification)(t,{type:"success"})}showError(t){(0,r.showNotification)(t,{type:"danger"})}reset(){this.setDirty(!1),this.$form.reset(),this._setState("ready")}isDirty(){return this._isDirty}setData(t){const e=this._flattenObject(t);for(const[t,s]of Object.entries(e))this._setFieldValue(t,s)}_flattenObject(t,e=""){const s={};for(const[i,r]of Object.entries(t)){const t=e?`${e}.${i}`:i;null===r||"object"!=typeof r||Array.isArray(r)||Object.values(r).every(t=>"boolean"==typeof t)?s[t]=r:Object.assign(s,this._flattenObject(r,t))}return s}_setFieldValue(t,e){const s=this.$form.querySelectorAll(`[name="${t}"]`);if(0===s.length)return;const i=s[0],r=i.type;"checkbox"===r?1===s.length?i.checked=!!e:"object"==typeof e&&s.forEach(t=>{t.checked=!!e[t.value]}):"radio"===r?s.forEach(t=>{t.checked=t.value===e}):(i.tagName,i.value=e)}}}}]);