(self.webpackChunkultimate_jekyll=self.webpackChunkultimate_jekyll||[]).push([[5605,6002],{634:()=>{},938:()=>{},2480:()=>{},3005:()=>{},4050:()=>{},5043:()=>{},5236:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var o=n(2984),c=n(5460);let i=null;const a=e=>new Promise(async function(t){i=e.webManager,await i.dom().ready();try{await async function(){u||(u=!0,r=new o.A("#notification-form",{allowResubmit:!1}),r.on("change",({data:e})=>{h(e),y(e),p(e)}),r.on("submit",async({data:e})=>{const t=function(e){console.log("[Debug] transformDataForAPI called"),console.log("[Debug] formData received:",e),console.log("[Debug] formData.notification:",e.notification);const t=new Date,n=e.notification||{};console.log("[Debug] notification object:",n),console.log("[Debug] notification.clickAction:",n.clickAction),console.log("[Debug] typeof notification:",typeof n),console.log("[Debug] Object.keys(notification):",Object.keys(n));const o=t.getTime(),c=new URL("https://promo-server.itwcreativeworks.com/redirect/notification");c.searchParams.set("id",o),c.searchParams.set("type","notification");const i=n.clickAction||"";return console.log("[Debug] clickActionValue to be set in URL:",i),c.searchParams.set("url",i),{id:o,notification:{icon:n.icon||"",title:n.title||"",body:n.body||"",clickAction:c.toString()},created:t.toISOString(),channels:e.channels||{},audience:e.audience||{},schedule:e.schedule||{}}}(e);t.reach={available:{total:s.totalUsers},filtered:{total:s.filteredUsers}},await async function(e){const t=w();return(0,c.A)(t,{method:"POST",timeout:6e4,response:"json",tries:1,log:!0,body:{command:"admin:send-notification",payload:e}})}(t),function(e){gtag("event","notification_sent",{notification_type:"admin",user_count:s.filteredUsers,channels:Object.keys(e.channels||{}).filter(t=>e.channels[t]?.enabled).join(",")}),fbq("trackCustom","AdminNotificationSent",{users:s.filteredUsers,channels:Object.keys(e.channels||{}).filter(t=>e.channels[t]?.enabled)}),ttq.track("SubmitForm",{content_id:"admin-notification",content_type:"product",content_name:"Admin Notification"})}(t),r.showSuccess(`Notification sent successfully to ${s.filteredUsers.toLocaleString()} users!`)}),function(){const e=document.querySelector('input[name="notification.icon"]');e&&e.addEventListener("input",e=>{!function(e){const t=document.querySelector("#preview-icon");t&&(e&&e.match(/^https?:\/\/.+/)?(t.src=e,t.onerror=()=>{t.src="https://via.placeholder.com/50"}):t.src="https://via.placeholder.com/50")}(e.target.value)});const t=document.querySelector('input[name="notification.title"]');t&&(i.isDevelopment()&&(t.value="Test Notification Title"),t.addEventListener("input",e=>{const t=e.target.value.length,n=document.querySelector("#title-char-count");n&&(n.textContent=`${t} / 60`,n.className=t>60?"text-danger":"text-muted")}));const n=document.querySelector('textarea[name="notification.body"]');n&&(i.isDevelopment()&&(n.value="This is a test notification body message for development."),n.addEventListener("input",e=>{const t=e.target.value.length,n=document.querySelector("#body-char-count");n&&(n.textContent=`${t} / 200`,n.className=t>200?"text-danger":"text-muted")}));const o=document.querySelector(".btn-set-auto-submit");o&&o.addEventListener("click",()=>{!function(){const e=new Date;e.setDate(e.getDate()+1),e.setHours(10,0,0,0);const t=e.toISOString().split("T")[0],n=document.querySelector('input[name="schedule.date"]'),o=document.querySelector('input[name="schedule.time"]');n&&(n.value=t),o&&(o.value="10:00"),b(e)}()});const c=document.querySelector(".btn-clear-auto-submit");c&&c.addEventListener("click",()=>{!function(){const e=document.querySelector('input[name="schedule.date"]'),t=document.querySelector('input[name="schedule.time"]');e&&(e.value=""),t&&(t.value=""),g()}()});const a=document.querySelector("#notification-preview-clickable");a&&a.addEventListener("click",()=>{const e=document.querySelector('input[name="notification.clickAction"]');e&&e.value&&window.open(e.value,"_blank","noopener,noreferrer")}),h(),r&&setTimeout(()=>{const e=r.getData();h(e),y(e),p(e)},100)}(),f(),i.auth().listen({account:!1},async e=>{console.log("Auth state for notification creator:",e),f(),await d(),m()}))}()}catch(e){i.sentry().captureException(new Error("Failed to initialize notification creator",{cause:e}))}return t()});let r=null,s={totalUsers:0,filteredUsers:0},l=null,u=!1;async function d(){try{const e=await(0,c.A)(w(),{method:"POST",timeout:6e4,response:"json",tries:2,log:!0,body:{command:"admin:firestore-read",payload:{path:"meta/stats"}}}),t=e?.notifications?.total||0;s.totalUsers=t,s.filteredUsers=t}catch(e){console.error("Failed to fetch user stats:",e),i.sentry().captureException(new Error("Failed to fetch user stats",{cause:e})),s.totalUsers=0,s.filteredUsers=0}}function m(){document.querySelectorAll(".notification-user-count").forEach(e=>{e.innerHTML=`${s.filteredUsers.toLocaleString()} / ${s.totalUsers.toLocaleString()}`})}function f(){document.querySelectorAll(".notification-user-count").forEach(e=>{e.innerHTML='<span class="spinner-border spinner-border-sm me-1" role="status"></span>Loading...'})}function h(e=null){e||(e=r?.getData()||{});const t=e.notification||{},n=document.querySelector("#preview-icon"),o=document.querySelector("#preview-title"),c=document.querySelector("#preview-body"),i=document.querySelector("#preview-time");n&&t.icon&&(n.src=t.icon,n.onerror=()=>{n.src="https://via.placeholder.com/50"}),o&&(o.textContent=t.title||"Notification Title"),c&&(c.textContent=t.body||"This is what your notification body will look like..."),i&&(i.textContent="Now")}function y(e){const t=e.notification||{},n=document.querySelector("#title-char-count");if(n){const e=(t.title||"").length;n.textContent=`${e} / 60`,n.className=e>60?"text-danger":"text-muted"}const o=document.querySelector("#body-char-count");if(o){const e=(t.body||"").length;o.textContent=`${e} / 200`,o.className=e>200?"text-danger":"text-muted"}}function p(e){if(e.schedule?.date&&e.schedule?.time){const t=new Date(`${e.schedule.date}T${e.schedule.time}`);t>new Date?b(t):g()}else g()}function b(e){g();const t=document.querySelector("#auto-submit-countdown");t&&(t.classList.remove("d-none"),l=setInterval(()=>{const n=new Date,o=e-n;if(o<=0)return g(),void d().then(()=>m()).finally(()=>{r.$form.requestSubmit()});const c=Math.floor(o/36e5),i=Math.floor(o%36e5/6e4),a=Math.floor(o%6e4/1e3);t.innerHTML=`<i class="bi bi-clock"></i> Auto-submit in: ${c}h ${i}m ${a}s`},1e3))}function g(){l&&(clearInterval(l),l=null);const e=document.querySelector("#auto-submit-countdown");e&&(e.classList.add("d-none"),e.innerHTML="")}function w(){return`${i.getFunctionsUrl("prod")}/bm_api`}},5460:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var o=n(4289),c=n.n(o);const i=async function(e,t={}){window.Manager;const o=JSON.parse(JSON.stringify(t)),{getAuth:i}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480)),a=i().currentUser;if(!a)throw new Error("No authenticated user found");const r=await a.getIdToken();return o.headers||(o.headers={}),o.headers.Authorization="Bearer "+r,c()(e,o)}},6600:()=>{},7664:()=>{},8466:()=>{}}]);