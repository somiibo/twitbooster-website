"use strict";(self.webpackChunkultimate_jekyll=self.webpackChunkultimate_jekyll||[]).push([[5725],{5460:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(4289),i=n.n(o);const s=async function(e,t={}){window.Manager;const o=JSON.parse(JSON.stringify(t)),{getAuth:s}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480)),c=s().currentUser;if(!c)throw new Error("No authenticated user found");const a=await c.getIdToken();return o.headers||(o.headers={}),o.headers.Authorization="Bearer "+a,i()(e,o)}},5725:(e,t,n)=>{n.r(t),n.d(t,{init:()=>u,loadData:()=>d});var o=n(5460),i=n(2984);let s=null,c=null,a=new Map,r=null;const l="true"===new URL(window.location.href).searchParams.get("authPopup")||window!==window.top;function u(e){s=e,async function(){console.log("[DEBUG] security.js - initializeSigninMethods() called"),c=s.firebaseAuth,async function(){try{const{getRedirectResult:e}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480)),t=await e(c);t&&t.user&&(s.utilities().showNotification("Google account connected successfully","success"),m())}catch(e){e.code&&"auth/no-auth-event"!==e.code&&(console.error("Redirect result error:",e),s.utilities().showNotification("Failed to connect Google account","danger"))}}(),m()}(),function(){const e=document.getElementById("signout-all-sessions-form");e&&!r&&(r=new i.A(e,{submittingText:"Signing out..."}),r.on("submit",async()=>{if(await new Promise(e=>setTimeout(e,1)),!confirm("Are you sure you want to sign out of all sessions? This will log you out everywhere, including this device."))throw new Error("Sign out cancelled.");await s.auth().signOut(),r.showSuccess("Successfully signed out of all sessions.")}))}()}function d(e){e&&(console.log("[DEBUG] security.js - loadData() called with account:",e),m(),function(){console.log("[DEBUG] security.js - initializeSigninMethodForms() called");const e=document.getElementById("signin-method-password-form");if(e&&!a.has("password")){console.log("[DEBUG] security.js - Initializing password FormManager");const t=new i.A(e,{allowResubmit:!1,submittingText:"Sending...",submittedText:"Email Sent!"});a.set("password",t),t.on("submit",async()=>{await async function(){const e=s.auth().getUser();if(!e||!e.email)throw new Error("Please log in to reset your password.");const{sendPasswordResetEmail:t}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480));await t(c,e.email)}(),t.showSuccess("Password reset email sent!")})}const t=document.getElementById("signin-method-google-form");if(t&&!a.has("google")){console.log("[DEBUG] security.js - About to initialize Google FormManager"),console.log("[DEBUG] security.js - Google form exists:",!!t);const e=new i.A(t,{submittingText:"Connecting..."});a.set("google",e),console.log("[DEBUG] security.js - Google FormManager initialized and stored"),e.on("submit",async({$submitButton:e})=>{const t=e?.getAttribute("data-action");"disconnect"===t?await async function(){if(await new Promise(e=>setTimeout(e,1)),!confirm("Are you sure you want to disconnect your Google account?"))throw new Error("Disconnection cancelled.");const{unlink:e}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480)),t=c.currentUser;if(t.providerData.length<=1)throw new Error("Cannot disconnect Google. You need at least one sign-in method.");try{await e(t,"google.com"),s.utilities().showNotification("Google account disconnected successfully","success")}catch(e){throw"auth/no-such-provider"===e.code?new Error("Google account is not connected"):e}}():"connect"===t&&await async function(){const{GoogleAuthProvider:e,linkWithPopup:t,linkWithRedirect:o}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480)),i=new e;if(l)try{const e=await t(c.currentUser,i);return s.utilities().showNotification("Google account connected successfully","success"),await c.currentUser.reload(),e}catch(e){if("auth/popup-blocked"!==e.code&&"auth/popup-closed-by-user"!==e.code&&"auth/cancelled-popup-request"!==e.code)throw"auth/credential-already-in-use"===e.code?new Error("This Google account is already linked to another user"):e;console.log("Popup failed, falling back to redirect:",e.code),await o(c.currentUser,i)}else console.log("Using redirect for Google account linking"),await o(c.currentUser,i)}(),m()})}const o=document.getElementById("2fa-btn");o&&o.addEventListener("click",g)}(),function(e){const t=document.getElementById("2fa-status"),n=document.getElementById("2fa-btn");e?.enabled?(t&&(t.innerHTML='<span class="badge bg-success">Enabled</span>'),n&&(n.textContent="Manage 2FA",n.className="btn btn-outline-primary")):(t&&(t.innerHTML='<span class="badge bg-secondary">Disabled</span>'),n&&(n.textContent="Enable 2FA",n.className="btn btn-primary"))}(e.security?.twoFactor),async function(e){const t=document.getElementById("active-sessions-list");if(!t)return;const n=[];if(e?.activity){const t={isCurrent:!0,device:p(e.activity.client?.userAgent),browser:w(e.activity.client?.userAgent),platform:e.activity.client?.platform,mobile:e.activity.client?.mobile,language:e.activity.client?.language,ip:e.activity.geolocation?.ip,city:e.activity.geolocation?.city,region:e.activity.geolocation?.region,country:e.activity.geolocation?.country,timestamp:e.activity.created?.timestamp,timestampUNIX:e.activity.created?.timestampUNIX};n.push(t)}try{const e=s.getApiUrl()+"/backend-manager";let t=await(0,o.A)(e,{method:"POST",timeout:6e4,response:"json",tries:2,body:{command:"user:get-active-sessions",payload:{}}})||{};if("true"===new URLSearchParams(window.location.search).get("_dev_prefill")){console.log("Adding fake session data for testing");const e=function(){const e=Date.now(),t=864e5;return{session_abc123:{_current:!1,platform:"Windows",ip:"98.137.246.8",timestamp:new Date(e-108e5).toISOString(),timestampUNIX:Math.floor((e-108e5)/1e3)},session_def456:{_current:!1,platform:"Darwin",ip:"192.168.1.42",timestamp:new Date(e-288e5).toISOString(),timestampUNIX:Math.floor((e-288e5)/1e3)},session_ghi789:{_current:!1,platform:"Linux",ip:"45.62.189.3",timestamp:new Date(e-t).toISOString(),timestampUNIX:Math.floor((e-t)/1e3)},session_jkl012:{_current:!1,platform:"Win32",ip:"203.0.113.45",timestamp:new Date(e-2*t).toISOString(),timestampUNIX:Math.floor((e-2*t)/1e3)},session_mno345:{_current:!1,platform:"Mac",ip:"172.217.16.195",timestamp:new Date(e-5*t).toISOString(),timestampUNIX:Math.floor((e-5*t)/1e3)}}}();t={...e,...t}}t&&"object"==typeof t&&Object.keys(t).forEach(e=>{const o=t[e];if(o._current)return;const i={isCurrent:!1,sessionId:e,platform:o.platform,ip:o.ip,timestamp:o.timestamp,timestampUNIX:o.timestampUNIX,device:f(o.platform),browser:"App • Desktop",mobile:void 0};n.push(i)})}catch(e){console.error("Failed to get active sessions:",e)}if(e?.lastActivity){const t={isCurrent:!1,device:p(e.lastActivity.client?.userAgent),browser:w(e.lastActivity.client?.userAgent),platform:e.lastActivity.client?.platform,mobile:e.lastActivity.client?.mobile,language:e.lastActivity.client?.language,ip:e.lastActivity.geolocation?.ip,city:e.lastActivity.geolocation?.city,region:e.lastActivity.geolocation?.region,country:e.lastActivity.geolocation?.country,timestamp:e.lastActivity.timestamp,timestampUNIX:e.lastActivity.timestampUNIX};n[0]&&t.ip===n[0].ip&&t.timestampUNIX===n[0].timestampUNIX||n.push(t)}if(0===n.length)return void(t.innerHTML='<p class="text-muted text-center py-3">No active sessions found.</p>');const i=n.map((e,t)=>{const o=e.device||"Unknown Device",i=e.browser||"Unknown Browser",s=function(e){const t=[];if(e.city){const n=e.city.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ");t.push(n)}return e.region&&t.push(e.region.toUpperCase()),e.country&&t.push(e.country.toUpperCase()),t.length>0?t.join(", "):null}(e);return`\n    <div class="px-0 py-3${t===n.length-1?"":" border-bottom"}">\n      <div class="d-flex justify-content-between align-items-start">\n        <div class="d-flex align-items-center">\n          <div class="d-flex align-items-center justify-content-center me-3 flex-shrink-0 text-muted">\n            ${function(e){const t=(e||"").toLowerCase();let n="desktop";return t.includes("iphone")||t.includes("ipad")||t.includes("ios")||t.includes("mac")?n="apple":t.includes("android")?n="android":t.includes("windows")?n="windows":t.includes("linux")?n="linux":t.includes("chrome")&&(n="chrome"),function(e){const t=document.querySelector(`#prerendered-icons [data-icon="${e}"]`);return t?t.innerHTML:""}(n)}(e.platform||o)}\n          </div>\n          <div>\n            <strong>${o}</strong>\n            <div class="text-muted small">${i}${void 0!==e.mobile?" • "+(e.mobile?"Mobile":"Desktop"):""}</div>\n            ${s?`<div class="text-muted small">${s}</div>`:""}\n            ${e.ip?`<div class="text-muted small">IP: ${e.ip}</div>`:""}\n          </div>\n        </div>\n        <div class="text-end">\n          <small class="text-muted">${function(e){if(!e)return"Unknown";const t=new Date(e),n=new Date-t;if(n<6e4)return"Just now";if(n<36e5){const e=Math.floor(n/6e4);return`${e} minute${e>1?"s":""} ago`}if(n<864e5){const e=Math.floor(n/36e5);return`${e} hour${e>1?"s":""} ago`}if(n<6048e5){const e=Math.floor(n/864e5);return`${e} day${e>1?"s":""} ago`}return t.toLocaleDateString()+" at "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}(e.timestamp||1e3*e.timestampUNIX)}</small>\n          ${e.isCurrent?'<span class="badge bg-primary ms-2">Current</span>':""}\n        </div>\n      </div>\n    </div>\n  `}).join("");t.innerHTML=i}(e))}async function m(){console.log("[DEBUG] security.js - updateSigninMethods() called");const e=c?.currentUser;if(!e)return void console.log("[DEBUG] security.js - No firebaseUser, returning");const t=s.auth().getUser();if(!t)return void console.log("[DEBUG] security.js - No user from webManager, returning");console.log("[DEBUG] security.js - firebaseUser.providerData:",e.providerData);const n=document.getElementById("password-email");if(n){const o=e.providerData?.some(e=>"password"===e.providerId);n.textContent=o?t.email:"Not set",console.log("[DEBUG] security.js - hasPassword:",o)}const o=document.getElementById("google-email"),i=document.getElementById("signin-method-google-form"),a=i?.querySelector('button[data-action="connect"]'),r=i?.querySelector('button[data-action="disconnect"]');if(console.log("[DEBUG] security.js - Google DOM elements:",{$googleEmail:!!o,$googleForm:!!i,$connectButton:!!a,$disconnectButton:!!r}),o&&a&&r){const t=e.providerData?.find(e=>"google.com"===e.providerId);console.log("[DEBUG] security.js - googleProvider:",t),console.log("[DEBUG] security.js - googleProvider found:",!!t),t?(console.log("[DEBUG] security.js - Showing disconnect button"),o.textContent=t.email||"Connected",a.classList.add("d-none"),r.classList.remove("d-none")):(console.log("[DEBUG] security.js - Showing connect button"),o.textContent="Not connected",a.classList.remove("d-none"),r.classList.add("d-none"))}}async function g(e){e.target.textContent.includes("Enable")?console.log("Starting 2FA setup..."):console.log("Managing 2FA settings...")}function p(e){if(!e)return"Unknown Device";const t=e.toLowerCase();return t.includes("iphone")?"iPhone":t.includes("ipad")?"iPad":t.includes("android")?t.includes("mobile")?"Android Phone":t.includes("tablet")?"Android Tablet":"Android Device":t.includes("windows phone")?"Windows Phone":t.includes("mac os x")||t.includes("macintosh")?"Mac":t.includes("windows nt")?"Windows PC":t.includes("linux")?"Linux":t.includes("cros")?"Chromebook":"Unknown Device"}function w(e){if(!e)return"Unknown Browser";const t=e.toLowerCase();return t.includes("edg/")?"Microsoft Edge":t.includes("chrome/")&&!t.includes("edg/")?"Chrome":t.includes("firefox/")?"Firefox":!t.includes("safari/")||t.includes("chrome/")||t.includes("edg/")?t.includes("opera/")||t.includes("opr/")?"Opera":t.includes("brave/")?"Brave":"Unknown Browser":"Safari"}function f(e){if(!e)return"Unknown Device";const t=e.toLowerCase();return t.includes("mac")||t.includes("darwin")?"macOS":t.includes("win")?"Windows":t.includes("linux")?"Linux":t.includes("android")?"Android":t.includes("ios")||t.includes("iphone")||t.includes("ipad")?"iOS":"Unknown"}}}]);